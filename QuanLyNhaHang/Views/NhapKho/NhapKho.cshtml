@using System.Globalization;
@{
    QuanLyNhaHangContext context = new QuanLyNhaHangContext();
    List<NhaCungCap> getListNhaCungCap()
    {
        return context.NhaCungCap.Where(x => x.Active == true).ToList();
    }
    List<HangHoa> getListHangHoa()
    {
        return context.HangHoa.Where(x => x.Active == true).ToList();
    }
    NhanVien nv = context.NhanVien.Find(Int32.Parse(User.Identity.Name));
    List<HangHoa> hangHoas = context.HangHoa
    .Include(x => x.IdnhhNavigation).Where(x => x.Active == true && x.IdnhhNavigation.NguyenLieu == true).ToList();

}

<style>
    .red-header {
        background-color: red;
        color: white;
    }

</style>
<div class="card">
    <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs nav-fill p-0" id="myTab" data-bs-toggle="tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Tạo phiếu</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Lịch sử nhập phiếu</a>
            </li>
        </ul>
    </div>

    <div class="card-body p-2">

        <div class="tab-content">
            
              <div class="tab-pane fade active show" id="home" role="tabpanel" aria-labelledby="home-tab">

                <form action="/download/BaoCaoHoaDon" method="post">

                    <div class="form-group p-2 mb-2"
                         id="groupTTSearchLichSu"
                         style="border-radius: 5px; border: 1px solid black">
                        <div class="row">
                            <label class="col-sm-1 col-lg-1 col-form-label">Số phiếu</label>
                            <div class="col-md-2 mb-2 col-lg-2">
                                <input class="form-control"
                                       type="text"
                                       name="soPN"
                                       value="Auto"
                                       placeholder="Từ ngày"
                                       disabled />
                            </div>
                            <label class="col-sm-1 col-lg-1 col-form-label">Nhà CC</label>
                            <div class="col-sm-4 col-lg-2">
                                <select name="nhaCungCap" class="form-select" style="width : 150px">
                                    <option selected>-- Nhà cung cấp--</option>
                                    @foreach (NhaCungCap n in getListNhaCungCap())
                                    {
                                        <option value="@n.Idncc">@n.TenNcc</option>
                                    }
                                </select>
                            </div>
                            <label class="col-sm-1 col-lg-1 col-form-label">Ngày nhập</label>
                            <div class="col-lg-2 col-sm-2">
                                <input class="form-control"
                                       type="text"
                                       name="ngayNhap"
                                       value="@DateTime.Now.ToString("dd-MM-yyyy")"
                                       placeholder="Ngày nhập" />
                            </div>

                            <div class="col-md-1 mb-2 col-lg-1 d-flex justify-content-end">
                                <button type="button" class="btn btn-primary" onclick="loadTableBCNK()">
                                    <i class="fa-solid fa-magnifying-glass"></i>
                                </button>
                            </div>
                        </div>
                        <div class="row">
                            <label class="col-sm-12 col-lg-1 col-form-label">Ghi chú</label>
                            <div class="col-md-2 mb-2 col-lg-2">
                                <input class="form-control"
                                       type="text"
                                       name="ghiChu"
                                       value="Auto"
                                       placeholder="Từ ngày"
                                        />
                            </div>
                        </div>
                    </div>
                    <div class="form-group p-2 mb-2"
                         id="groupThemHangHoa"
                         style="border-radius: 5px; border: 1px solid black">
                        <div class="row">
                            <label class="col-sm-1 col-lg-1 col-form-label">Tên hàng hóa</label>
                            <select name="hangHoa" class="form-select" style="width : 200px">
                                <option selected value="">-- Tên hàng hóa--</option>
                                @foreach (HangHoa n in getListHangHoa())
                                {
                                    <option value="@n.Idhh">@n.TenHh</option>
                                }
                            </select>
                            <label class="col-sm-1 col-lg-1 col-form-label">Đơn vị tính</label>
                            <div class="col-sm-4 col-lg-2">
                                <input class="form-control"
                                       type="text"
                                       readonly
                                       name="donViTinh"
                                       id="donViTinh"
                                       value=""
                                       placeholder="Ngày sản xuất" />
                            </div>
                            <label class="col-sm-1 col-lg-1 col-form-label">Ngày sản xuất</label>
                            <div class="col-lg-2 col-sm-2">
                                <input class="form-control"
                                       type="text"
                                       name="ngaySanXuat"
                                       id="ngaySanXuat"
                                       placeholder="Ngày sản xuất" />
                            </div>

                            @* <div class="col-md-1 mb-2 col-lg-1 d-flex justify-content-end">
                                <button type="button" class="btn btn-primary" onclick="loadTableBCNK()">
                                    <i class="fa-solid fa-magnifying-glass"></i>
                                </button>
                            </div> *@
                            <label class="col-sm-1 col-lg-1 col-form-label">Hạn sử dụng</label>
                            <div class="col-lg-2 col-sm-2">
                                <input class="form-control"
                                       type="text"
                                       name="hanSuDung"
                                       id="hanSuDung"
                                       placeholder="Hạn sử dụng" />
                            </div>
                        </div>
                        <div class="row">
                            <label class="col-sm-12 col-lg-1 col-form-label">Số lượng</label>
                            <div class="col-md-2 mb-2 col-lg-2">
                                <input class="form-control formatted-number"
                                       type="text"
                                       name="soLuong"
                                       id="soLuong"
                                       placeholder="Số lượng" />
                            </div>
                            <label class="col-sm-12 col-lg-1 col-form-label">Đơn giá</label>
                            <div class="col-md-2 mb-2 col-lg-2">
                                <input class="form-control formatted-number"
                                       type="text"
                                       name="donGia"
                                       id="donGia"
                                       placeholder="Đơn giá" />
                            </div>
                            <label class="col-sm-12 col-lg-1 col-form-label">Thành tiền</label>
                            <div class="col-md-2 mb-2 col-lg-2">
                                <input class="form-control formatted-number"
                                       type="text"
                                       name="thanhTien"
                                       id="thanhTien"
                                       placeholder="Thành tiền" />
                            </div>
                            <div class="col-md-2 mb-2 col-lg-2">
                                <button type="button" class="btn btn-primary" onclick="AddRowPhieuNhapKho()">
                                    Thêm
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="table-nhapkho" class="table-responsive" style="min-height:47vh;height:47vh;">
                        <table class="table table-bordered table-vcenter table-input" id="tableTaoChiTietPhieuNhap">
                            <thead>
                                <tr class="text-wrap">
                                    <th class="text-center p-1 first-th-column text-wrap" style="width:32px;">TT</th>
                                    <th class="text-center p-1 w-25 text-wrap" style="position: sticky;left: 33px;z-index: 4 !important;">Tên hàng hóa</th>
                                    <th class="text-center p-1 text-wrap">SL nhập</th>
                                    <th class="text-center p-1 text-wrap">Giá nhập</th>
                                    <th class="text-center p-1 text-wrap">Thành tiền</th>
                                    <th class="text-center p-1 text-wrap">Ngày SX</th>
                                    <th class="text-center p-1 text-wrap">Hạn SD</th>
                                    <th class="text-center last-th-column p-1">
                                        <a href="#" class="text-red" id="remove-all-phieuNhapCt">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                                <path d="M4 7l16 0"></path>
                                                <path d="M10 11l0 6"></path>
                                                <path d="M14 11l0 6"></path>
                                                <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
                                                <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
                                            </svg>
                                        </a>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="tBody-ThemChiTietPhieuNhap">
                            </tbody>
                        </table>
                    </div>
                </form>
                <div class="card-footer p-2">
                    <div class="row">
                        <div class="col-lg-2 col-12">
                        </div>
                        <div class="col-lg-2 col-12 mb-1">
                        </div>
                        <div class="col-lg-2 col-12 mb-1">
                        </div>
                        <div class="col-lg-2 col-12 mb-1">
                            <label class="form-label mb-0">Tổng cộng:</label>
                            <input type="text" class="form-control formatted-number-float" id="tongTra" placeholder="Tổng cộng" readonly>
                        </div>
                        <div class="col-lg-2 col-12 mb-1">
                            <label class="form-label mb-0">Người lập phiếu:</label>
                            <input id="txtNhanVienTao" type="text" class="form-control" placeholder="Người lập phiếu" readonly=""
                                   value="@nv.Ten">
                        </div>
                        <div class="col-2 mb-1">
                            <label class="form-label mb-0 text-white">.</label>
                            <div class="row justify-content-end">
                                <div class="col-auto">
                                    <button class="btn" id="btnXoaTrang">
                                        Xóa trắng
                                    </button>
                                </div>
                                <div class="col-auto">
                                    <button class="btn btn-primary" onclick="ThemPhieuNhap()">
                                        Lưu
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                    <div class="form-group p-2 mb-2" id="groupTTSearchLichSu" style="border-radius: 5px; border: 1px solid black;">
                        <div class="row">
                            <label class="col-sm-1 col-lg-1 col-form-label">Từ ngày</label>
                            <div class="col-md-2 mb-2 col-lg-2">
                                <input class="form-control" type="text" name="fromDay" id="fromDay" value="@DateTime.Now.ToString("dd-MM-yyyy")" placeholder="Từ ngày" />
                            </div>
                            <label class="col-sm-1 col-lg-1 col-form-label">Đến ngày</label>
                            <div class="col-lg-2 col-sm-2">
                                <input class="form-control" type="text" name="toDay" id="toDay" value="@DateTime.Now.ToString("dd-MM-yyyy")" placeholder="Tới ngày" />
                            </div>
                        </div>
                        <div class="row">
                            <label class="col-sm-1 col-lg-1 col-form-label">Hàng hoá</label>
                            <div class="col-sm-4 col-lg-4">
                                <select id="hhLS" name="hhLS" class="form-select">
                                    <option selected value="0">Tất cả</option>
                                    @foreach (HangHoa n in hangHoas)
                                    {
                                        <option value="@n.Idhh">@n.TenHh</option>
                                    }
                                </select>
                            </div>
                            <label class="col-sm-1 col-lg-1 col-form-label">Số phiếu</label>
                            <div class="col-md-2 mb-2 col-lg-2">
                                <input class="form-control" type="text" name="soPhieuLS" id="soPhieuLS" placeholder="Số phiếu" />
                            </div>
                            <div class="col-md-1 mb-2 col-lg-1 d-flex justify-content-end">
                                <button type="button" class="btn btn-primary" onclick="getDSXKNL()">
                                    <i class="fa-solid fa-magnifying-glass"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="tableLichSuXuat" class="table-responsive" style="white-space:nowrap;overflow-y: auto;">
                        @* <table id="LichSuNhap" class="table table-striped table-hover text-center display nowrap" style="width:100%;max-height:500px">
                        <thead>
                        <tr>
                        <th class="text-center">Số phiếu</th>
                        <th class="text-center">Tên khách hàng</th>
                        <th class="text-center">Ngày tạo</th>
                        <th class="text-center">Số hoá đơn</th>
                        <th class="text-center">Ngày hoá đơn</th>
                        <th class="text-center">Nhân viên tạo</th>
                        <th class="text-center">Ghi chú</th>
                        <th class="text-center">Tùy chọn</th>
                        </tr>
                        </thead>
                        <tbody> *@
                        @*   @foreach (PhieuNhap p in getListPhieuNhap())
                        {
                        <tr>
                        <td>@p.SoPx</td>
                        <td>@p.IdkhNavigation.TenKh</td>
                        <td>@p.NgayTao.Value.ToString("dd-MM-yyyy HH:mm")</td>
                        <td>@p.SoHd</td>
                        <td>@dayToString(p.NgayHd)</td>
                        <td>@p.IdnvNavigation.TenNv</td>
                        <td>@p.GhiChu</td>
                        <td>
                        <a href="PhieuNhapKhoPDF" class="btn btn-outline-success">In</a>
                        <button type="button" onclick="ViewPhieuNhap('@p.Id')" class="btn btn-outline-primary mx-1">Xem</button>
                        </td>
                        </tr>
                        }  *@

                        @* </tbody>
                        </table> *@
                        <table class="table table-bordered table-hover table-striped text-center" id="tableChiTietPhieuNhap">
                            <thead style="position: sticky; top: 0;">
                                <tr>
                                    <th>Ngày xuất</th>
                                    <th>Nhà cung cấp</th>
                                    <th>Số phiếu</th>
                                    <th>Số Lượng HH</th>
                                    <th>Tổng tiền</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-XemPhieuNhap">
                            </tbody>
                        </table>
                    </div>
                    <div class="form-group p-2 mb-2" style="border-radius: 5px; border: 1px solid black;">
                        <div class="row">
                            <label class="col-sm-1 col-lg-1 col-form-label">Phải trả</label>
                            <div class="col-md-2 col-lg-2">
                                <input type="text" class="form-control" readonly id="TienThanhToanTabLS" placeholder="Thanh toán">
                            </div>
                        </div>
                    </div>
                    <div class="row justify-content-end">
                        <div class="col-sm-auto col-form-label">
                            <button class="btn btn-info col-lg-auto col-sm-2" style="margin-left: auto" type="submit">Xuất tất cả </button>
                        </div>

                    </div>
            </div>

        </div>
    </div>
</div>
<script src="~/jschinh/nhapkho.js" defer asp-append-version="true"></script>
<script src="~/jschinh/common.js" defer asp-append-version="true"></script>